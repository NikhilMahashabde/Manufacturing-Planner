{% extends "index.html" %}

{% block title %} 

<a href="/"> Home</a> 
 / 
<a href="/workorders"> Work Orders</a> 
 / 
<a href="/workorder/{{ idnumber }}"> {{ idnumber }} </a>
 / 
<a href="/workorder/{{ idnumber }}/edit"> Edit </a>

{% endblock %}
{% block tabletitle %} {{ idnumber }} {% endblock %}

{% block main %}

<!-- <button onclick="window.location.href='/forms/workorder/add'">Create New Order</button> -->
<form method="POST" action="/api/workorder/{{idnumber}}/process">

    <div style="margin: 10px; background-color: white;">
      <button type="submit" name="wo" value="delete">Delete Work Order {{ idnumber }} </button>
      <button type="submit" name="wo" value="update">Submit Changes</button>
    </div>
    

    <div style="margin: 10px; background-color: white;">

      <table class="table" id = "workorder.{{ idnumber }}.table" style="margin: 10px; background-color: white;">
        <thead>
          <tr>
            <th scope="workOrderNumber">Name</th>
            <th scope="itemNumber">Item Number</th>
            <th scope="Itemdescription">Item Description</th>
            <th scope="quantity">Quantity</th>
            <th scope="project">Project</th>
            <th scope="duedate">Due Date</th>
          </tr>
        </thead>
        <tbody id="tableWorkOrder.{{ idnumber }}.Body">
  
        </tbody>
      </table>

    </div>
   


  <div class="d-flex justify-content-center" id="loadingSpinner">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>



  <h2> Work Order status</h2>

  <div id = "woStatusSwitches">


    <div class="form-check form-check-inline" >
      <input class="form-check-input" type="checkbox" id="inlineCheckboxFirmed" value="option1">
      <label class="form-check-label" for="inlineCheckbox1">Order Firmed</label>
    </div>

    <div class="form-check form-check-inline" >
      <input class="form-check-input" type="checkbox" id="inlineCheckboxDisassembled" value="option2">
      <label class="form-check-label" for="inlineCheckbox2">Disassembled</label>
    </div>

    <div class="form-check form-check-inline" >
      <input class="form-check-input" type="checkbox" id="inlineCheckboxReceived" value="option1">
      <label class="form-check-label" for="inlineCheckbox1">Order Received</label>
    </div>

    <div class="form-check form-check-inline" >
      <input class="form-check-input" type="checkbox" id="inlineCheckboxReassembled" value="option1">
      <label class="form-check-label" for="inlineCheckbox1">Order Reassembled</label>
    </div>

    <div class="form-check form-check-inline" >
      <input class="form-check-input" type="checkbox" id="inlineCheckboxRework" value="option1">
      <label class="form-check-label" for="inlineCheckbox1">Order Rework</label>
    </div>

    <div class="form-check form-check-inline" >
      <input class="form-check-input" type="checkbox" id="inlineCheckboxClosed" value="option1">
      <label class="form-check-label" for="inlineCheckbox1">Order Closed</label>
    </div>
   
    </div>

    <div>
      <h2>History</h2>

    </div>


  <div class="mb-3" style="margin: 10px; background-color: white;">
    <label for="formFile" class="form-label">Upload Work Order Pick Slip</label>
    <input class="form-control" type="file" id="formFile">
  </div>
  <div class="mb-3" style="margin: 10px; background-color: white";>
    <label for="formFile" class="form-label">Upload Work Order Traveler</label>
    <input class="form-control" type="file" id="formFile">
  </div>








  
</form>

{% endblock %}

{% block jsscripts %}
<script>
 
function createInputHiddenInRow(row, valueInput = "", name){
    const inputElement = document.createElement("input")
    inputElement.setAttribute('class', 'form-control');
    inputElement.setAttribute('type', 'text');
    inputElement.setAttribute('aria-label', 'Disabled input example');
    inputElement.setAttribute('hidden', '');
    inputElement.name = name
    cell = row.insertCell();
    cell.appendChild(inputElement)
    inputElement.value = valueInput
    return inputElement
}

function createInputElementInRow(row, valueInput = "", name) {
  const inputElement = document.createElement('input');
  inputElement.setAttribute('class', 'form-control');
  inputElement.setAttribute('type', 'text');
  inputElement.setAttribute('aria-label', 'Default input example');
  inputElement.name = name
  cell = row.insertCell();
  cell.appendChild(inputElement)
  inputElement.value = valueInput
  return inputElement;
}


fetch('/api/workorder/{{ idnumber }}')
  .then(response => response.json())
  .then(workorder => {
    console.log(workorder);

    [...document.getElementsByClassName("spinner-border")].forEach(element => {
      element.remove()
    });

    let woTable = document.getElementById("tableWorkOrder.{{idnumber}}.Body");
    
    for (let i = 0; i < workorder.header.length; i++) {
        let row = woTable.insertRow();

        // let cell0 = row.insertCell();
        // let tickbox = document.createElement("input")
        // tickbox.type = "checkbox" 
        // tickbox.name = workorder[i].wonumber + ".selected";
        // cell0.appendChild(tickbox)
        
        let wonumber = createInputElementInRow(row, workorder.header[i].wonumber, workorder.header[i].id +".wonumber")
        let itemnumber = createInputElementInRow(row, workorder.header[i].itemnumber, workorder.header[i].id +".itemnumber")
        let itemdescription = createInputElementInRow(row, workorder.header[i].itemdescription, workorder.header[i].id +".itemdescription")
        let quantity = createInputElementInRow(row, workorder.header[i].quantity, workorder.header[i].id +".quantity")
        let project = createInputElementInRow(row, workorder.header[i].project, workorder.header[i].id +".project")
        let duedate = createInputElementInRow(row, workorder.header[i].duedate, workorder.header[i].id +".duedate")
        let woid = createInputHiddenInRow(row, workorder.header[i].id, workorder.header[i].id + ".id")

      }
    }
  )
  .catch(error => console.error(error));

</script>

{% endblock %}